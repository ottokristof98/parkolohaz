<!DOCTYPE html>
<html>
    <head>
        <title>ExceptionManager</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
         <!-- Latest compiled and minified CSS -->
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
        <!-- jQuery library -->
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
        <!-- Latest compiled JavaScript -->
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script> 
        
        <script>
            
            var version = "7";
            
            function loadExceptions(){
                var table = document.getElementById("exceptionTable");
                var requestToSend = {"task": "getAllException"};
                $.ajax({
                    url: "/ExceptionManager_" + version + "/ExceptionDataController",
                    type: "POST",
                    data: requestToSend,
                    success: function(response){
                        for(var i = 0; i < response.length; i++){
                            var newRow = table.insertRow(i + 1);
                            var dateCol = newRow.insertCell(0);
                            var descriptionCol = newRow.insertCell(1);
                            dateCol.innerHTML = "<a onclick=\"loadOneException(" + response[i].id + ")\" style=\"cursor:pointer;\">" + response[i].createdon + "</a>";
                            descriptionCol.innerHTML = response[i].description;
                        }
                    },
                    error: function(){
                        alert("Hiba!");
                    }
                });
            }
            
            function loadOneException(id){
                var requestToSend = {"task": "loadOneException", "id": id};
                //alert(id);
                $.ajax({
                    url: "/ExceptionManager_" + version + "/ExceptionDataController",
                    type: "POST",
                    data: requestToSend,
                    success: function(response){
                        var exData = document.getElementById("exData");
                        exData.style = "display:block;";
                        document.getElementById("dateText").value = response.createdon;
                        document.getElementById("groupText").value = response.groupname;
                        document.getElementById("stText").innerHTML = response.stacktrace;
                        document.getElementById("dsText").innerHTML = response.description;
                        document.getElementById("hiddenBoxForId").value = id;
                    },
                    error: function(){
                        alert("Hiba");
                    }
                });
            }
            
            function createNullPointer(){
                var requestToSend = {"task": "createNullPointerException"};
                $.ajax({
                    url: "/ExceptionManager_" + version + "/ExceptionDataController",
                    type: "POST",
                    data: requestToSend,
                    success: function(response, textStatus, responseStatus){
                        if(responseStatus.status == 200){
                            var table = document.getElementById("exceptionTable");
                            table.innerHTML = "";
                            table.innerHTML = "<thead><tr><th scope=\"col\">DateTime</th><th scope=\"col\">Description</th></tr></thead>";
                            for(var i = 0; i < response.length; i++){
                                var newRow = table.insertRow(i + 1);
                                var dateCol = newRow.insertCell(0);
                                var descriptionCol = newRow.insertCell(1);
                                dateCol.innerHTML = "<a onclick=\"loadOneException(" + response[i].id + ")\" style=\"cursor:pointer;\">" + response[i].createdon + "</a>";
                                descriptionCol.innerHTML = response[i].description;
                            }   
                        }
                        else{
                            alert("hiba");
                        }
                    },
                    error: function(){}
                });
            }
            
            function saveDS(){
                var id = document.getElementById("hiddenBoxForId").value;
                if(id == null){
                    alert("Hiba a lekérés során!");
                    return 0;
                }
                var description = document.getElementById("dsText").value;
                var requestToSend = {"task": "saveDS", "id": id, "description": description};
                $.ajax({
                    url: "/ExceptionManager_" + version + "/ExceptionDataController",
                    type: "POST",
                    data: requestToSend,
                    success: function(response){
                        alert("A mentés állapota: " + response.valasz);
                    },
                    error:function(){
                        alert("Hiba a kommunikációban!");
                    }
                });
            }
            
        </script>
        
    </head>
    <body onload="loadExceptions()">
        <div class="container">
            
            <button class="btn btn-danger" onclick="createNullPointer()">NullPointer</button>
            <div id="exData" style="display:none;">
                <button class="btn btn-danger" style="float:right;" onclick="document.getElementById('exData').style='display:none;'">X</button>
                <label for="dateText">Dátum:</label>
                <input type="text" class="form-control" disabled id="dateText">
                <label for="groupText">Csoport:</label>
                <input type="text" class="form-control" disabled id="groupText">
                <label for="stText">StackTrace:</label>
                <textarea class="form-control" disabled id="stText" style="resize:none;" rows="15"></textarea>
                <label for="dsText">Megjegyzés:</label>
                <textarea class="form-control" id="dsText" style="resize:none;"></textarea>
                <button class="btn btn-primary" id="saveDS" onclick="saveDS()">Megjegyzés mentése</button>
                <input type="hidden" value="" id="hiddenBoxForId" />
            </div>
            <table class="table table-stripped" id="exceptionTable">
                <thead>
                    <tr>
                        <th scope="col">DateTime</th>
                        <th scope="col">Description</th>
                    </tr>
                </thead>
            </table>
            
        </div>
    </body>
</html>
